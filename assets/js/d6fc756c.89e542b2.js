"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2193],{7572(e,n,t){t.d(n,{R:()=>o,x:()=>a});var r=t(5212);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},9692(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"guides/testing","title":"Testing with formatjs","description":"Intl APIs requirements","source":"@site/docs/guides/testing-with-react-intl.md","sourceDirName":"guides","slug":"/guides/testing","permalink":"/docs/guides/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/formatjs/formatjs/edit/main/website/docs/guides/testing-with-react-intl.md","tags":[],"version":"current","frontMatter":{"id":"testing","title":"Testing with formatjs"},"sidebar":"docs","previous":{"title":"Bundling with formatjs","permalink":"/docs/guides/bundler-plugins"},"next":{"title":"Distributing i18n-friendly libraries","permalink":"/docs/guides/distribute-libraries"}}');var s=t(1968),i=t(7572);const o={id:"testing",title:"Testing with formatjs"},a=void 0,l={},c=[{value:"<code>Intl</code> APIs requirements",id:"intl-apis-requirements",level:2},{value:"Mocha",id:"mocha",level:3},{value:"Command Line",id:"command-line",level:4},{value:"Browser",id:"browser",level:4},{value:"Shallow Rendering",id:"shallow-rendering",level:2},{value:"Testing Example Components That Use React Intl",id:"testing-example-components-that-use-react-intl",level:3},{value:"ShortDate (Basic)",id:"shortdate-basic",level:4},{value:"DOM Rendering",id:"dom-rendering",level:2},{value:"Helper function",id:"helper-function",level:3},{value:"@testing-library/react",id:"testing-libraryreact",level:2},{value:"Helper function",id:"helper-function-1",level:3},{value:"Usage",id:"usage",level:3},{value:"Jest",id:"jest",level:2},{value:"Snapshot Testing",id:"snapshot-testing",level:3},{value:"Helper function",id:"helper-function-2",level:4},{value:"Usage",id:"usage-1",level:4},{value:"DOM Testing",id:"dom-testing",level:3},{value:"Vitest",id:"vitest",level:2},{value:"Setup",id:"setup",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Testing with Vitest",id:"testing-with-vitest",level:3},{value:"Snapshot Testing with Vitest",id:"snapshot-testing-with-vitest",level:3},{value:"Running Tests",id:"running-tests",level:3},{value:"Storybook",id:"storybook",level:2},{value:"Intl",id:"intl",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h2,{id:"intl-apis-requirements",children:[(0,s.jsx)(n.code,{children:"Intl"})," APIs requirements"]}),"\n",(0,s.jsxs)(n.p,{children:["React Intl uses the built-in ",(0,s.jsxs)(n.a,{href:"https://mdn.io/intl",children:[(0,s.jsx)(n.code,{children:"Intl"})," APIs"]})," in JavaScript. Make sure your environment satisfy the requirements listed in ",(0,s.jsxs)(n.a,{href:"/docs/guides/runtime-requirements",children:[(0,s.jsx)(n.code,{children:"Intl"})," APIs requirements"]})]}),"\n",(0,s.jsx)(n.h3,{id:"mocha",children:"Mocha"}),"\n",(0,s.jsxs)(n.p,{children:["If you're using ",(0,s.jsx)(n.a,{href:"https://mochajs.org/",children:"Mocha"})," as your test runner and testing on older JavaScript runtimes, you can load the Intl Polyfill via the CLI or by adding a ",(0,s.jsx)(n.code,{children:"<script>"})," in the browser."]}),"\n",(0,s.jsx)(n.h4,{id:"command-line",children:"Command Line"}),"\n",(0,s.jsxs)(n.p,{children:["Run ",(0,s.jsx)(n.code,{children:"mocha"})," and auto-polyfill the runtime if needed:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ mocha --recursive test/\n"})}),"\n",(0,s.jsx)(n.h4,{id:"browser",children:"Browser"}),"\n",(0,s.jsxs)(n.p,{children:["You can either load the polyfill in the browser from ",(0,s.jsx)(n.code,{children:"node_modules"})," or use the ",(0,s.jsx)(n.a,{href:"https://polyfill-fastly.io/v2/docs/",children:"polyfill-fastly.io"})," service from the Financial Times:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script src="https://polyfill-fastly.io/v2/polyfill.min.js?features=Intl,Intl.~locale.en-US"><\/script>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"shallow-rendering",children:"Shallow Rendering"}),"\n",(0,s.jsxs)(n.p,{children:["React's ",(0,s.jsx)(n.code,{children:"react-addons-test-utils"})," package contains a ",(0,s.jsx)(n.a,{href:"http://facebook.github.io/react/docs/test-utils.html#shallow-rendering",children:"shallow rendering"})," feature which you might use to test your app's React components. If a component you're trying to test using ",(0,s.jsx)(n.code,{children:"ReactShallowRenderer"})," uses React Intl \u2014 specifically ",(0,s.jsx)(n.code,{children:"injectIntl()"})," \u2014 you'll need to do extra setup work because React Intl components expect to be nested inside an ",(0,s.jsx)(n.code,{children:"<IntlProvider>"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"testing-example-components-that-use-react-intl",children:"Testing Example Components That Use React Intl"}),"\n",(0,s.jsxs)(n.p,{children:["The following examples will assume ",(0,s.jsx)(n.code,{children:"mocha"}),", ",(0,s.jsx)(n.code,{children:"expect"}),", and ",(0,s.jsx)(n.code,{children:"expect-jsx"})," test framework."]}),"\n",(0,s.jsx)(n.h4,{id:"shortdate-basic",children:"ShortDate (Basic)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'import React from \'react\'\nimport {FormattedDate} from \'react-intl\'\n\nconst ShortDate = props => (\n  <FormattedDate\n    value={props.date}\n    year="numeric"\n    month="short"\n    day="2-digit"\n  />\n)\n\nexport default ShortDate\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Testing the ",(0,s.jsx)(n.code,{children:"<ShortDate>"})," example component is no different than testing any other basic component in your app using React's shallow rendering:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import expect from 'expect'\nimport expectJSX from 'expect-jsx'\nimport React from 'react'\nimport {createRenderer} from 'react-addons-test-utils'\nimport {FormattedDate} from 'react-intl'\nimport ShortDate from '../short-date'\n\nexpect.extend(expectJSX)\n\ndescribe('<ShortDate>', function () {\n  it('renders', function () {\n    const renderer = createRenderer()\n    const date = new Date()\n\n    renderer.render(<ShortDate date={date} />)\n    expect(renderer.getRenderOutput()).toEqualJSX(\n      <FormattedDate value={date} year=\"numeric\" month=\"short\" day=\"2-digit\" />\n    )\n  })\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"dom-rendering",children:"DOM Rendering"}),"\n",(0,s.jsxs)(n.p,{children:["If you use the DOM in your tests, you need to supply the ",(0,s.jsx)(n.code,{children:"IntlProvider"})," context to your components using composition:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"let element = ReactTestUtils.renderIntoDocument(\n  <IntlProvider>\n    <MyComponent />\n  </IntlProvider>\n)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["However this means that the ",(0,s.jsx)(n.code,{children:"element"})," reference is now pointing to the ",(0,s.jsx)(n.code,{children:"IntlProvider"}),' instead of your component. To retrieve a reference to your wrapped component, you can use "refs" with these changes to the code:']}),"\n",(0,s.jsxs)(n.p,{children:["In your component, remember to add ",(0,s.jsx)(n.code,{children:"{forwardRef: true}"})," when calling ",(0,s.jsx)(n.code,{children:"injectIntl()"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"class MyComponent extends React.Component {\n  ...\n  myClassFn() { ... }\n}\nexport default injectIntl(MyComponent, {forwardRef: true});\n"})}),"\n",(0,s.jsx)(n.p,{children:'In your test, add a "ref" to extract the reference to your tested component:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"const element = React.createRef()\nReactTestUtils.renderIntoDocument(\n  <IntlProvider>\n    <MyComponent ref={element} />\n  </IntlProvider>\n)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can now access the wrapped component instance from ",(0,s.jsx)(n.code,{children:"element"})," like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"element.current.myClassFn()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"helper-function",children:"Helper function"}),"\n",(0,s.jsxs)(n.p,{children:["Since you will have to do this in all your unit tests, you should probably wrap that setup in a ",(0,s.jsx)(n.code,{children:"render"})," function like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"function renderWithIntl(element) {\n  let instance\n\n  ReactTestUtils.renderIntoDocument(\n    <IntlProvider>\n      {React.cloneElement(element, {\n        ref: instance,\n      })}\n    </IntlProvider>\n  )\n\n  return instance\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can now use this in your tests like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"const element = React.createRef();\nrenderWithIntl(<MyElement ref={element}>);\nelement.current.myClassFn();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"testing-libraryreact",children:"@testing-library/react"}),"\n",(0,s.jsxs)(n.p,{children:["We recommend using ",(0,s.jsx)(n.a,{href:"https://testing-library.com/docs/react-testing-library/intro",children:(0,s.jsx)(n.code,{children:"@testing-library/react"})})," for testing React components. Below is a helper function to wrap your components with ",(0,s.jsx)(n.code,{children:"IntlProvider"})," for testing."]}),"\n",(0,s.jsx)(n.h3,{id:"helper-function-1",children:"Helper function"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// test-utils.tsx\nimport React from 'react'\nimport {render as rtlRender} from '@testing-library/react'\nimport {IntlProvider} from 'react-intl'\nimport * as messages from '../locales/en.json' with {type: 'json'}\n\ninterface RenderOptions {\n  locale?: string\n  messages?: Record<string, string>\n  [key: string]: any\n}\n\nfunction render(\n  ui: React.ReactElement,\n  {\n    locale = 'en',\n    messages: customMessages,\n    ...renderOptions\n  }: RenderOptions = {}\n) {\n  function Wrapper({children}: {children: React.ReactNode}) {\n    return (\n      <IntlProvider locale={locale} messages={customMessages || messages}>\n        {children}\n      </IntlProvider>\n    )\n  }\n  return rtlRender(ui, {wrapper: Wrapper, ...renderOptions})\n}\n\n// re-export everything\nexport * from '@testing-library/react'\n\n// override render method\nexport {render}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,s.jsxs)(n.p,{children:["Create a file with the above helper in e.g. ",(0,s.jsx)(n.code,{children:"test-utils.tsx"})," and import the methods you need in your tests."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import React from 'react'\nimport {render, screen} from './test-utils'\nimport {FormattedMessage} from 'react-intl'\n\nconst Greeting = ({name}: {name: string}) => (\n  <div data-testid=\"greeting\">\n    <FormattedMessage\n      id=\"greeting\"\n      defaultMessage=\"Hello {name}!\"\n      values={{name}}\n    />\n  </div>\n)\n\ntest('it should render FormattedMessage with the name', () => {\n  render(<Greeting name=\"World\" />)\n  expect(screen.getByTestId('greeting')).toHaveTextContent('Hello World!')\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"jest",children:"Jest"}),"\n",(0,s.jsxs)(n.p,{children:["Testing with Jest can be divided into two approaches: snapshot's testing and DOM testing. Snapshot's testing is a relatively new feature and works out of the box. If you'd like DOM testing you can use ",(0,s.jsx)(n.code,{children:"@testing-library/react"})," as shown above or React's TestUtils."]}),"\n",(0,s.jsx)(n.h3,{id:"snapshot-testing",children:"Snapshot Testing"}),"\n",(0,s.jsx)(n.p,{children:"Snapshot testing is a new feature of Jest that automatically generates text snapshots of your components and saves them on the disk so if the UI output changes, you get notified without manually writing any assertions on the component output. Use either helper function or mock as described below."}),"\n",(0,s.jsx)(n.h4,{id:"helper-function-2",children:"Helper function"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import React from 'react'\nimport renderer from 'react-test-renderer'\nimport {IntlProvider} from 'react-intl'\n\nconst createComponentWithIntl = (children, props = {locale: 'en'}) => {\n  return renderer.create(<IntlProvider {...props}>{children}</IntlProvider>)\n}\n\nexport default createComponentWithIntl\n"})}),"\n",(0,s.jsx)(n.h4,{id:"usage-1",children:"Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import React from 'react'\nimport createComponentWithIntl from '../../utils/createComponentWithIntl'\nimport AppMain from '../AppMain'\n\ntest('app main should be rendered', () => {\n  const component = createComponentWithIntl(<AppMain />)\n\n  let tree = component.toJSON()\n\n  expect(tree).toMatchSnapshot()\n\n  tree.props.onClick()\n\n  tree = component.toJSON()\n\n  expect(tree).toMatchSnapshot()\n})\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can find runnable example ",(0,s.jsx)(n.a,{href:"https://github.com/formatjs/formatjs/tree/master/packages/react-intl/examples/jest-snapshot-testing",children:"here"})," and more info about Jest ",(0,s.jsx)(n.a,{href:"http://facebook.github.io/jest/",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"dom-testing",children:"DOM Testing"}),"\n",(0,s.jsxs)(n.p,{children:["If you want to use Jest with DOM Testing, refer to the ",(0,s.jsx)(n.code,{children:"@testing-library/react"})," section above or check the official Jest ",(0,s.jsx)(n.a,{href:"http://facebook.github.io/jest/docs/tutorial-react.html#dom-testing",children:"documentation"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"vitest",children:"Vitest"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://vitest.dev/",children:"Vitest"})," is a blazing fast unit test framework powered by Vite. Testing React components with ",(0,s.jsx)(n.code,{children:"react-intl"})," in Vitest works similarly to Jest, and you can use the same ",(0,s.jsx)(n.code,{children:"@testing-library/react"})," helper functions."]}),"\n",(0,s.jsx)(n.h3,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.p,{children:"First, ensure you have the necessary dependencies:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install -D vitest @testing-library/react @testing-library/jest-dom happy-dom\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Add a ",(0,s.jsx)(n.code,{children:"vitest.config.ts"})," file to your project:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {defineConfig} from 'vitest/config'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  test: {\n    environment: 'happy-dom',\n    setupFiles: ['./vitest.setup.ts'],\n  },\n})\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Create a ",(0,s.jsx)(n.code,{children:"vitest.setup.ts"})," file to add global test utilities:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import '@testing-library/jest-dom/vitest'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"testing-with-vitest",children:"Testing with Vitest"}),"\n",(0,s.jsxs)(n.p,{children:["You can use the same test helper function from the ",(0,s.jsx)(n.code,{children:"@testing-library/react"})," section. Here's a complete example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// test-utils.tsx\nimport React from 'react'\nimport {render as rtlRender} from '@testing-library/react'\nimport {IntlProvider} from 'react-intl'\nimport * as messages from '../locales/en.json' with {type: 'json'}\n\ninterface RenderOptions {\n  locale?: string\n  messages?: Record<string, string>\n  [key: string]: any\n}\n\nfunction render(\n  ui: React.ReactElement,\n  {\n    locale = 'en',\n    messages: customMessages,\n    ...renderOptions\n  }: RenderOptions = {}\n) {\n  function Wrapper({children}: {children: React.ReactNode}) {\n    return (\n      <IntlProvider locale={locale} messages={customMessages || messages}>\n        {children}\n      </IntlProvider>\n    )\n  }\n  return rtlRender(ui, {wrapper: Wrapper, ...renderOptions})\n}\n\n// re-export everything\nexport * from '@testing-library/react'\n\n// override render method\nexport {render}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// MyComponent.test.tsx\nimport {describe, it, expect} from 'vitest'\nimport {render, screen} from './test-utils'\nimport {FormattedMessage, FormattedNumber} from 'react-intl'\n\nconst PriceDisplay = ({amount}: {amount: number}) => (\n  <div>\n    <FormattedMessage id=\"price.label\" defaultMessage=\"Price:\" />{' '}\n    <FormattedNumber value={amount} style=\"currency\" currency=\"USD\" />\n  </div>\n)\n\ndescribe('PriceDisplay', () => {\n  it('should render price with formatted currency', () => {\n    render(<PriceDisplay amount={99.99} />)\n    expect(screen.getByText(/Price:/i)).toBeInTheDocument()\n    expect(screen.getByText(/\\$99\\.99/)).toBeInTheDocument()\n  })\n\n  it('should support different locales', () => {\n    render(<PriceDisplay amount={99.99} />, {locale: 'de-DE'})\n    // German locale formatting\n    expect(screen.getByText(/99,99/)).toBeInTheDocument()\n  })\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"snapshot-testing-with-vitest",children:"Snapshot Testing with Vitest"}),"\n",(0,s.jsx)(n.p,{children:"Vitest also supports snapshot testing similar to Jest:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import {describe, it} from 'vitest'\nimport {render} from './test-utils'\nimport {FormattedDate} from 'react-intl'\n\nconst DateDisplay = ({date}: {date: Date}) => (\n  <FormattedDate value={date} year=\"numeric\" month=\"long\" day=\"numeric\" />\n)\n\ndescribe('DateDisplay', () => {\n  it('should match snapshot', () => {\n    const {container} = render(<DateDisplay date={new Date('2024-01-15')} />)\n    expect(container).toMatchSnapshot()\n  })\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"running-tests",children:"Running Tests"}),"\n",(0,s.jsxs)(n.p,{children:["Add test scripts to your ",(0,s.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "test": "vitest",\n    "test:ui": "vitest --ui",\n    "test:coverage": "vitest --coverage"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Then run your tests:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm run test\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For more information, check out the ",(0,s.jsx)(n.a,{href:"https://vitest.dev/",children:"Vitest documentation"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"storybook",children:"Storybook"}),"\n",(0,s.jsx)(n.h3,{id:"intl",children:"Intl"}),"\n",(0,s.jsxs)(n.p,{children:["If you want to use ",(0,s.jsx)(n.code,{children:"react-intl"})," inside of ",(0,s.jsx)(n.a,{href:"https://storybooks.js.org",children:"Storybook"})," you can use ",(0,s.jsx)(n.a,{href:"https://github.com/truffls/storybook-addon-intl",children:(0,s.jsx)(n.code,{children:"storybook-addon-intl"})})," which provides an easy to use wrapper for ",(0,s.jsx)(n.code,{children:"react-intl"})," including a locale switcher so you can test your component in all provided languages."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);