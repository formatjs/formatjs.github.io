(self.webpackChunk=self.webpackChunk||[]).push([[2349],{3905:(e,t,n)=>{"use strict";n.d(t,{Zo:()=>m,kt:()=>u});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=p(n),u=r,h=c["".concat(s,".").concat(u)]||c[u]||d[u]||i;return n?a.createElement(h,o(o({ref:t},m),{},{components:n})):a.createElement(h,o({ref:t},m))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7517:(e,t,n)=>{"use strict";n.r(t),n.d(t,{frontMatter:()=>l,contentTitle:()=>s,metadata:()=>p,toc:()=>m,default:()=>c});var a=n(2122),r=n(9756),i=(n(7294),n(3905)),o=["components"],l={id:"upgrade-guide-3x",title:"Upgrade Guide (v2 -> v3)"},s=void 0,p={unversionedId:"react-intl/upgrade-guide-3x",id:"react-intl/upgrade-guide-3x",isDocsHomePage:!1,title:"Upgrade Guide (v2 -> v3)",description:"Breaking API Changes",source:"@site/docs/react-intl/upgrade-guide-3.x.md",sourceDirName:"react-intl",slug:"/react-intl/upgrade-guide-3x",permalink:"/docs/react-intl/upgrade-guide-3x",editUrl:"https://github.com/formatjs/formatjs/edit/main/website/docs/react-intl/upgrade-guide-3.x.md",version:"current",frontMatter:{id:"upgrade-guide-3x",title:"Upgrade Guide (v2 -> v3)"},sidebar:"api",previous:{title:"Upgrade Guide (v3 -> v4)",permalink:"/docs/react-intl/upgrade-guide-4x"},next:{title:"Upgrade Guide (v1 -> v2)",permalink:"/docs/react-intl/upgrade-guide-2x"}},m=[{value:"Breaking API Changes",id:"breaking-api-changes",children:[]},{value:"Use React 16.3 and upwards",id:"use-react-163-and-upwards",children:[]},{value:"Migrate withRef to forwardRef",id:"migrate-withref-to-forwardref",children:[]},{value:"New useIntl hook as an alternative of injectIntl HOC",id:"new-useintl-hook-as-an-alternative-of-injectintl-hoc",children:[]},{value:"Migrate to using native Intl APIs",id:"migrate-to-using-native-intl-apis",children:[]},{value:"TypeScript Support",id:"typescript-support",children:[]},{value:"FormattedRelativeTime",id:"formattedrelativetime",children:[]},{value:"Enhanced <code>FormattedMessage</code> &amp; <code>formatMessage</code> rich text formatting",id:"enhanced-formattedmessage--formatmessage-rich-text-formatting",children:[]},{value:"ESM Build",id:"esm-build",children:[{value:"Jest",id:"jest",children:[]},{value:"webpack",id:"webpack",children:[]}]},{value:"Creating intl without using Provider",id:"creating-intl-without-using-provider",children:[]},{value:"Message Format Syntax Changes",id:"message-format-syntax-changes",children:[{value:"Escape character has been changed to apostrophe (<code>&#39;</code>).",id:"escape-character-has-been-changed-to-apostrophe-",children:[]},{value:"Placeholder argument syntax change",id:"placeholder-argument-syntax-change",children:[]}]},{value:"Testing",id:"testing",children:[]}],d={toc:m};function c(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"breaking-api-changes"},"Breaking API Changes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"addLocaleData")," has been removed. See ",(0,i.kt)("a",{parentName:"li",href:"#migrate-to-using-native-intl-apis"},"Migrate to using native Intl APIs")," for more details."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ReactIntlLocaleData")," has been removed. See ",(0,i.kt)("a",{parentName:"li",href:"#migrate-to-using-native-intl-apis"},"Migrate to using native Intl APIs")," for more details."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"intlShape")," has been removed. See ",(0,i.kt)("a",{parentName:"li",href:"#typescript-support"},"TypeScript Support")," for more details."),(0,i.kt)("li",{parentName:"ul"},"Change default ",(0,i.kt)("inlineCode",{parentName:"li"},"textComponent")," in ",(0,i.kt)("inlineCode",{parentName:"li"},"IntlProvider")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"React.Fragment"),". In order to keep the old behavior, you can explicitly set ",(0,i.kt)("inlineCode",{parentName:"li"},"textComponent")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"span"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<IntlProvider textComponent="span" />\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"FormattedRelative")," has been renamed to ",(0,i.kt)("inlineCode",{parentName:"li"},"FormattedRelativeTime")," and its API has changed significantly. See ",(0,i.kt)("a",{parentName:"li",href:"#formattedrelativetime"},"FormattedRelativeTime")," for more details."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"formatRelative")," has been renamed to ",(0,i.kt)("inlineCode",{parentName:"li"},"formatRelativeTime")," and its API has changed significantly. See ",(0,i.kt)("a",{parentName:"li",href:"#formattedrelativetime"},"FormattedRelativeTime")," for more details."),(0,i.kt)("li",{parentName:"ul"},"Message Format syntax changes. See ",(0,i.kt)("a",{parentName:"li",href:"#message-format-syntax-changes"},"Message Format Syntax Changes")," for more details."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IntlProvider")," no longer inherits from upstream ",(0,i.kt)("inlineCode",{parentName:"li"},"IntlProvider"),".")),(0,i.kt)("h2",{id:"use-react-163-and-upwards"},"Use React 16.3 and upwards"),(0,i.kt)("p",null,"React Intl v3 supports the new context API, fixing all kinds of tree update problems \ud83c\udf89\nIn addition it makes use of the new lifecycle hooks (and gets rid of the ",(0,i.kt)("a",{parentName:"p",href:"https://reactjs.org/blog/2018/03/27/update-on-async-rendering.html"},"deprecated")," ones).\nIt also supports the new ",(0,i.kt)("inlineCode",{parentName:"p"},"React.forwardRef()")," enabling users to directly access refs using the standard ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," prop (see beneath for further information)."),(0,i.kt)("h2",{id:"migrate-withref-to-forwardref"},"Migrate withRef to forwardRef"),(0,i.kt)("p",null,"With the update to React ",(0,i.kt)("inlineCode",{parentName:"p"},">= 16.3")," we got the option to use the new ",(0,i.kt)("inlineCode",{parentName:"p"},"React.forwardRef()")," feature and because of this deprecated the use of the ",(0,i.kt)("inlineCode",{parentName:"p"},"withRef")," option for the ",(0,i.kt)("inlineCode",{parentName:"p"},"injectIntl")," HOC in favour of ",(0,i.kt)("inlineCode",{parentName:"p"},"forwardRef"),".\nWhen ",(0,i.kt)("inlineCode",{parentName:"p"},"forwardRef")," is set to true, you can now simply pretend the HOC wasn't there at all."),(0,i.kt)("p",null,"Intl v2:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from 'react'\nimport {injectIntl} from 'react-intl'\n\nclass MyComponent extends React.Component {\n  doSomething = () => console.log(this.state || null)\n\n  render() {\n    return <div>Hello World</div>\n  }\n}\n\nexport default injectIntl(MyComponent, {withRef: true})\n\n// somewhere else\nclass Parent extends React.Component {\n  componentDidMount() {\n    this.myComponentRef.getWrappedInstance().doSomething()\n  }\n\n  render() {\n    return (\n      <MyComponent\n        ref={ref => {\n          this.myComponentRef = ref\n        }}\n      />\n    )\n  }\n}\n")),(0,i.kt)("p",null,"Intl v3:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from 'react'\nimport {injectIntl} from 'react-intl'\n\nclass MyComponent extends React.Component {\n  doSomething = () => console.log(this.state || null)\n\n  render() {\n    return <div>Hello World</div>\n  }\n}\n\nexport default injectIntl(MyComponent, {forwardRef: true})\n\n// somewhere else\nclass Parent extends React.Component {\n  myComponentRef = React.createRef()\n\n  componentDidMount() {\n    this.myComponentRef.doSomething() // no need to call getWrappedInstance()\n  }\n\n  render() {\n    return <MyComponent ref={this.myComponentRef} />\n  }\n}\n")),(0,i.kt)("h2",{id:"new-useintl-hook-as-an-alternative-of-injectintl-hoc"},"New useIntl hook as an alternative of injectIntl HOC"),(0,i.kt)("p",null,"This v3 release also supports the latest React hook API for user with React ",(0,i.kt)("inlineCode",{parentName:"p"},">= 16.8"),". You can now take ",(0,i.kt)("inlineCode",{parentName:"p"},"useIntl")," hook as an alternative to ",(0,i.kt)("inlineCode",{parentName:"p"},"injectIntl")," HOC on ",(0,i.kt)("em",{parentName:"p"},"function components"),". Both methods allow you to access the ",(0,i.kt)("inlineCode",{parentName:"p"},"intl")," instance, here is a quick comparison:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"// injectIntl\nimport {injectIntl} from 'react-intl'\n\nconst MyComponentWithHOC = injectIntl(({intl, ...props}) => {\n  // do something\n})\n\n// useIntl\nimport {useIntl} from 'react-intl'\n\nconst MyComponentWithHook = props => {\n  const intl = useIntl()\n\n  // do something\n}\n")),(0,i.kt)("p",null,"To keep the API surface clean and simple, we only provide ",(0,i.kt)("inlineCode",{parentName:"p"},"useIntl")," hook in the package. If preferable, user can wrap this built-in hook to make customized hook like ",(0,i.kt)("inlineCode",{parentName:"p"},"useFormatMessage")," easily. Please visit React's official website for more general ",(0,i.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/hooks-intro.html"},"introduction on React hooks"),"."),(0,i.kt)("h2",{id:"migrate-to-using-native-intl-apis"},"Migrate to using native Intl APIs"),(0,i.kt)("p",null,"React Intl v3 no longer comes with CLDR data and rely on native Intl API instead. Specifically the new APIs we're relying on are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/PluralRules"},"Intl.PluralRules"),": This can be polyfilled using ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@formatjs/intl-pluralrules"},"this package"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RelativeTimeFormat"},"Intl.RelativeTimeFormat"),": This can be polyfilled using ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@formatjs/intl-relativetimeformat"},"this package"),".")),(0,i.kt)("p",null,"This shift is meant to future-proof React Intl as these APIs are all stable and being implemented in modern browsers. This also means we no longer package and consume CLDRs in this package."),(0,i.kt)("p",null,"If you previously were using ",(0,i.kt)("inlineCode",{parentName:"p"},"addLocaleData")," to support older browsers, we recommend you do the following:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If you're supporting browsers that do not have ",(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/PluralRules"},"Intl.PluralRules")," (e.g IE11 & Safari 12-), include this ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@formatjs/intl-pluralrules"},"polyfill")," in your build."),(0,i.kt)("li",{parentName:"ol"},"If you're supporting browsers that do not have ",(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RelativeTimeFormat"},"Intl.RelativeTimeFormat")," (e.g IE11, Edge, Safari 13-), include this ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@formatjs/intl-relativetimeformat"},"polyfill")," in your build along with individual CLDR data for each locale you support.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"require('@formatjs/intl-pluralrules/polyfill')\nrequire('@formatjs/intl-pluralrules/locale-data/de') // Add locale data for de\n\nrequire('@formatjs/intl-relativetimeformat/polyfill')\nrequire('@formatjs/intl-relativetimeformat/locale-data/de') // Add locale data for de\n")),(0,i.kt)("p",null,"When using React Intl in Node.js, your ",(0,i.kt)("inlineCode",{parentName:"p"},"node")," binary has to either:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Get compiled with ",(0,i.kt)("inlineCode",{parentName:"li"},"full-icu")," using these ",(0,i.kt)("a",{parentName:"li",href:"https://nodejs.org/api/intl.html"},"instructions"))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"OR")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Uses ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/full-icu"},(0,i.kt)("inlineCode",{parentName:"a"},"full-icu")," npm package"))),(0,i.kt)("h2",{id:"typescript-support"},"TypeScript Support"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"react-intl")," has been rewritten in TypeScript and thus has native TypeScript support. Therefore, we've also removed ",(0,i.kt)("inlineCode",{parentName:"p"},"prop-types")," dependency and expose ",(0,i.kt)("inlineCode",{parentName:"p"},"IntlShape")," as an interface instead."),(0,i.kt)("p",null,"All types should be available from top level ",(0,i.kt)("inlineCode",{parentName:"p"},"index")," file without importing from specific subfiles. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import {IntlShape} from 'react-intl' // Correct\nimport {IntlShape} from 'react-intl/lib/types' // Incorrect\n")),(0,i.kt)("p",null,"If we're missing any interface top level support, please let us know and/or submitting a PR is greatly appreciated :)"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You might need to make a few changes to your code if you were relying on the now deprecated ",(0,i.kt)("strong",{parentName:"p"},"@types/react-intl")," package. The most common example is ",(0,i.kt)("inlineCode",{parentName:"p"},"InjectedIntlProps")," which must be replaced with ",(0,i.kt)("inlineCode",{parentName:"p"},"WrappedComponentProps"),"."))),(0,i.kt)("h2",{id:"formattedrelativetime"},"FormattedRelativeTime"),(0,i.kt)("p",null,"When we introduced ",(0,i.kt)("inlineCode",{parentName:"p"},"FormattedRelative"),", the spec for ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RelativeTimeFormat"},(0,i.kt)("inlineCode",{parentName:"a"},"Intl.RelativeTimeFormat"))," was still unstable. It has now reached stage 3 and multiple browsers have implemented it. However, its API is different from ",(0,i.kt)("inlineCode",{parentName:"p"},"FormattedRelative")," so we've adjusted its API to match the spec which means it's not backwards compatible."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"All ",(0,i.kt)("inlineCode",{parentName:"li"},"units")," (such as ",(0,i.kt)("inlineCode",{parentName:"li"},"day-short"),") becomes a combination of ",(0,i.kt)("inlineCode",{parentName:"li"},"unit")," & ",(0,i.kt)("inlineCode",{parentName:"li"},"style"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<FormattedRelative units="second-short"/>\n// will be\n<FormattedRelativeTime unit="second" style="short"/>\n')),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"style")," becomes ",(0,i.kt)("inlineCode",{parentName:"li"},"numeric")," (which is the default):")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<FormattedRelative style="numeric"/>\n// will be\n<FormattedRelativeTime />\n\n<FormattedRelative style="best fit"/>\n// will be\n<FormattedRelativeTime numeric="auto"/>\n')),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"Type of ",(0,i.kt)("inlineCode",{parentName:"li"},"value")," is no longer ",(0,i.kt)("inlineCode",{parentName:"li"},"Date"),", but rather ",(0,i.kt)("inlineCode",{parentName:"li"},"delta")," in the specified ",(0,i.kt)("inlineCode",{parentName:"li"},"unit"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<FormattedRelative value={Date.now() - 1000} units="second-narrow"/>\n// will be\n<FormattedRelativeTime value={-1} unit="second" style="narrow" />\n\n<FormattedRelative value={Date.now() + 2000} units="second-narrow"/>\n// will be\n<FormattedRelativeTime value={2} unit="second" style="narrow" />\n')),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"updateInterval")," becomes ",(0,i.kt)("inlineCode",{parentName:"li"},"updateIntervalInSeconds")," and will only take the time delta in seconds. Update behavior remains the same, e.g:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<FormattedRelativeTime\n  value={2}\n  numeric="auto"\n  unit="second"\n  style="narrow"\n  updateIntervalInSeconds={1}\n/>\n// Initially prints: `in 2s`\n// 1 second later: `in 1s`\n// 1 second later: `now`\n// 1 second later: `1s ago`\n// 60 seconds later: `1m ago`\n')),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"initialNow")," has been removed.")),(0,i.kt)("p",null,"Similarly, the functional counterpart of this component which is ",(0,i.kt)("inlineCode",{parentName:"p"},"formatRelative")," has been renamed to ",(0,i.kt)("inlineCode",{parentName:"p"},"formatRelativeTime")," and its parameters have been changed to reflect this component's props accordingly."),(0,i.kt)("ol",{start:7},(0,i.kt)("li",{parentName:"ol"},"Implementing ",(0,i.kt)("inlineCode",{parentName:"li"},"FormattedRelative")," behavior")),(0,i.kt)("p",null,"You can use ",(0,i.kt)("inlineCode",{parentName:"p"},"@formatjs/intl-utils")," to get close to the previous behavior like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import {selectUnit} from '@formatjs/intl-utils'\nconst {value, unit} = selectUnit(Date.now() - 48 * 3600 * 1000)\n// render\n;<FormattedRelativeTime value={value} unit={unit} />\n")),(0,i.kt)("h2",{id:"enhanced-formattedmessage--formatmessage-rich-text-formatting"},"Enhanced ",(0,i.kt)("inlineCode",{parentName:"h2"},"FormattedMessage")," & ",(0,i.kt)("inlineCode",{parentName:"h2"},"formatMessage")," rich text formatting"),(0,i.kt)("p",null,"In v2, in order to do rich text formatting (embedding a ",(0,i.kt)("inlineCode",{parentName:"p"},"ReactElement"),"), you had to do this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<FormattedMessage\n  defaultMessage="To buy a shoe, { link } and { cta }"\n  values={{\n    link: (\n      <a class="external_link" target="_blank" href="https://www.shoe.com/">\n        visit our website\n      </a>\n    ),\n    cta: <strong class="important">eat a shoe</strong>,\n  }}\n/>\n')),(0,i.kt)("p",null,"Now you can do:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<FormattedMessage\n  defaultMessage="To buy a shoe, <a>visit our website</a> and <cta>eat a shoe</cta>"\n  values={{\n    a: msg => (\n      <a class="external_link" target="_blank" href="https://www.shoe.com/">\n        {msg}\n      </a>\n    ),\n    cta: msg => <strong class="important">{msg}</strong>,\n  }}\n/>\n')),(0,i.kt)("p",null,"The change solves several issues:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Contextual information was lost when you need to style part of the string: In this example above, ",(0,i.kt)("inlineCode",{parentName:"li"},"link")," effectively is a blackbox placeholder to a translator. It can be a person, an animal, or a timestamp. Conveying contextual information via ",(0,i.kt)("inlineCode",{parentName:"li"},"description")," & ",(0,i.kt)("inlineCode",{parentName:"li"},"placeholder")," variable is often not enough since the variable can get sufficiently complicated."),(0,i.kt)("li",{parentName:"ol"},"This brings feature-parity with other translation libs, such as ",(0,i.kt)("a",{parentName:"li",href:"https://projectfluent.org/"},"fluent")," by Mozilla (using Overlays).")),(0,i.kt)("p",null,"If previously in cases where you pass in a ",(0,i.kt)("inlineCode",{parentName:"p"},"ReactElement")," to a placeholder we highly recommend that you rethink the structure so that as much text is declared as possible:"),(0,i.kt)("p",null,"Before"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<FormattedMessage\n  defaultMessage="Hello, {name} is {awesome} and {fun}"\n  values={{\n    name: <b>John</b>,\n    awesome: <span style="font-weight: bold;">awesome</span>\n    fun: <span>fun and <FormattedTime value={Date.now()}/></span>\n  }}\n/>\n')),(0,i.kt)("p",null,"After"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'<FormattedMessage\n  defaultMessage="Hello, <b>John</b> is <custom>awesome</custom> and <more>fun and {ts, time}</more>"\n  values={{\n    b: name => <b>{name}</b>,\n    custom: str => <span style="font-weight: bold;">{str}</span>,\n    more: chunks => <span>{chunks}</span>,\n  }}\n/>\n')),(0,i.kt)("h2",{id:"esm-build"},"ESM Build"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"react-intl")," and its underlying libraries (",(0,i.kt)("inlineCode",{parentName:"p"},"intl-messageformat-parser"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"intl-messageformat"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"@formatjs/intl-relativetimeformat"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"intl-format-cache"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"intl-utils"),") export ESM artifacts. This means you should configure your build toolchain to transpile those libraries."),(0,i.kt)("h3",{id:"jest"},"Jest"),(0,i.kt)("p",null,"Add ",(0,i.kt)("inlineCode",{parentName:"p"},"transformIgnorePatterns")," to always include those libraries, e.g:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"{\n  transformIgnorePatterns: [\n    '/node_modules/(?!intl-messageformat|intl-messageformat-parser).+\\\\.js$',\n  ],\n}\n")),(0,i.kt)("h3",{id:"webpack"},"webpack"),(0,i.kt)("p",null,"If you're using ",(0,i.kt)("inlineCode",{parentName:"p"},"babel-loader"),", add those libraries in ",(0,i.kt)("inlineCode",{parentName:"p"},"include"),", e.g:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'include: [\n  path.join(__dirname, "node_modules/react-intl"),\n  path.join(__dirname, "node_modules/intl-messageformat"),\n  path.join(__dirname, "node_modules/intl-messageformat-parser"),\n],\n')),(0,i.kt)("h2",{id:"creating-intl-without-using-provider"},"Creating intl without using Provider"),(0,i.kt)("p",null,"We've added a new API called ",(0,i.kt)("inlineCode",{parentName:"p"},"createIntl")," that allows you to create an ",(0,i.kt)("inlineCode",{parentName:"p"},"IntlShape")," object without using ",(0,i.kt)("inlineCode",{parentName:"p"},"Provider"),". This allows you to format things outside of React lifecycle while reusing the same ",(0,i.kt)("inlineCode",{parentName:"p"},"intl")," object. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import {createIntl, createIntlCache, RawIntlProvider} from 'react-intl'\n\n// This is optional but highly recommended\n// since it prevents memory leak\nconst cache = createIntlCache()\n\nconst intl = createIntl({\n  locale: 'fr-FR',\n  messages: {}\n}, cache)\n\n// Call imperatively\nintl.formatNumber(20)\n\n// Pass it to IntlProvider\n<RawIntlProvider value={intl}>{foo}</RawIntlProvider>\n")),(0,i.kt)("p",null,"This is especially beneficial in SSR where you can reuse the same ",(0,i.kt)("inlineCode",{parentName:"p"},"intl")," object across requests."),(0,i.kt)("h2",{id:"message-format-syntax-changes"},"Message Format Syntax Changes"),(0,i.kt)("p",null,"We've rewritten our parser to be more faithful to ",(0,i.kt)("a",{parentName:"p",href:"https://unicode-org.github.io/icu/userguide/format_parse/messages/"},"ICU Message Format"),", in order to potentially support skeleton. So far the backwards-incompatible changes are:"),(0,i.kt)("h3",{id:"escape-character-has-been-changed-to-apostrophe-"},"Escape character has been changed to apostrophe (",(0,i.kt)("inlineCode",{parentName:"h3"},"'"),")."),(0,i.kt)("p",null,"Previously while we were using ICU message format syntax, our escape char was backslash (",(0,i.kt)("inlineCode",{parentName:"p"},"\\"),"). This however creates issues with strict ICU translation vendors that support other implementations like ICU4J/ICU4C. Thanks to ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pyrocat101"},"@pyrocat101")," we've changed this behavior to be spec-compliant. This means:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'// Before\n<FormattedMessage defaultMessage="\\\\{foo\\\\}" /> //prints out "{foo}"\n\n// After\n<FormattedMessage defaultMessage="\'{foo}\'" /> //prints out "{foo}"\n')),(0,i.kt)("p",null,"We highly recommend reading the spec to learn more about how quote/escaping works ",(0,i.kt)("a",{parentName:"p",href:"https://unicode-org.github.io/icu/userguide/format_parse/messages"},"here")," under ",(0,i.kt)("strong",{parentName:"p"},"Quoting/Escaping")," section."),(0,i.kt)("h3",{id:"placeholder-argument-syntax-change"},"Placeholder argument syntax change"),(0,i.kt)("p",null,"Placeholder argument can no longer have ",(0,i.kt)("inlineCode",{parentName:"p"},"-")," (e.g: ",(0,i.kt)("inlineCode",{parentName:"p"},"this is a {placeholder-var}")," is invalid but ",(0,i.kt)("inlineCode",{parentName:"p"},"this is a {placeholder_var}")," is)."),(0,i.kt)("h2",{id:"testing"},"Testing"),(0,i.kt)("p",null,"We've removed ",(0,i.kt)("inlineCode",{parentName:"p"},"IntlProvider.getChildContext")," for testing and now you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"createIntl")," to create a standalone ",(0,i.kt)("inlineCode",{parentName:"p"},"intl")," object outside of React and use that for testing purposes. See ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/testing"},"Testing with React Intl")," for more details."))}c.isMDXComponent=!0}}]);